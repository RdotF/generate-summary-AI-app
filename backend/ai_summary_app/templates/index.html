<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI summary generator</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!--loading animation-->
  <style> 
      .animate-bounce-delay-0 {
        animation-delay: 0s;
      }
      .animate-bounce-delay-1 {
        animation-delay: 0.2s; 
      }
      .animate-bounce-delay-2 {
        animation-delay: 0.4s; 
      }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-blue-50 font-sans antialised">
  <!--Nav bar-->
  <nav class="bg-green-300 p-4 text-black flex justify-between">
    <div>
      <h1 class="text-2xl font-bold">
        Резюме видео с AI
      </h1>
    </div>
    <div class="flex flex-col sm:flex-row justify-between items-end
            space-y-2 sm:space-y-0 sm:space-x-4">
        <div class="transition-transform transform hover:scale-105">
             <a href="#" class="text-black hover:text-green-800">Привет, {{user.username}}!</a>
        </div>
        <div class="transition-transform transform hover:scale-105">
        <a href="{% url 'logout' %}" class=" p-1 text-black  hover:text-green-800">Выйти</a>
      </div>
    </div>
  </nav>

  <br/>
  <br/>
  <!--Main-->
  <div clas="flex-grow container mx-auto mt-10 px-4 sm:px-0">
    <div class="max-w-3xl mx-auto bg-green-50 p-6 rounded-lg shadow-md flex flex-col">
      <!-- intro section -->
        <div class="text-center">
            <h2 class="text-2xl font-semibold mb-5">Краткое содержание видео с помощью ИИ</h2>
            <p class="text-gray-800">
                Генерируйте качественные статьи для блога или краткое содержание видео, используя искусственный интеллект.
                Просто вставьте ссылку с Youtube/Rutube видео внизу и позвольте ИИ создать контент за вас!  
            </p>
        </div>
        <!-- input -->
         <br/>
         <div>
          <h2 class="text-xl font-semibold mb-3">Вставьте вашу ссылку </h2>
            <div class="flex space-x-4">
              <input id="videoLink" placeholder="Ссылка..." type="url" 
              class="flex-grow p-2 border border-gray-400 rounded-l-md">
              <button id="generateSummaryButton" class="transition-transform transform hover:scale-105 hover:text-green-800 bg-green-400 text-black font-semibold px-4 py-2 rounded-r-md" >
                Сгенерировать
              </button>
            </div>
            <!-- loading animation here -->
              
             <div id="loading" style="display: none" class="mt-6 flex flex-row items-center justify-center space-x-2">
                <div class="w-4 h-4 bg-green-400 rounded-full animate-bounce animate-bounce-delay-0" ></div>
                <div class="w-4 h-4 bg-green-400 rounded-full animate-bounce animate-bounce-delay-1" ></div>
                <div class="w-4 h-4 bg-green-400 rounded-full animate-bounce animate-bounce-delay-2" ></div>
             </div>
            <!-- generated text display -->
            <section class="mt-10 flex-grow">
                <h2 id='generatedContentTitle' style="display:none" class="text-xl mb-4 font-bold">Краткое содержание видео</h2>
                <div id="generatedContent" class="mt-2 text-gray-800 space-y-4">
                    
                </div>
            </section>
         </div>
    </div>
  </div>
  <footer class="p-2 text-center mt-10">
    Opensourced by <a href="https://github.com/RdotF" class="font-semibold text-green-600 hover:underline">RdotF</a>
  </footer>

  <script>
      document.getElementById('generateSummaryButton').addEventListener('click', async () => {
      const youtubeLink = document.getElementById('videoLink').value;
      const loadingIndicator = document.getElementById('loading');
      const summaryContentTitle = document.getElementById('generatedContentTitle');
      const summaryContent = document.getElementById('generatedContent');

      if (youtubeLink) {
        document.getElementById('loading').style.display = 'flex'
        loadingIndicator.classList.remove('hidden');
        summaryContent.innerHTML = '';

        const endpointUrl = '/generate-summary';

        try {
          const response = await fetch(endpointUrl, {
            method: 'POST', 
            header: {
              'Content-Type': 'application/json',
            }, 
            body: JSON.stringify({link: youtubeLink})
          });

          const data = await response.json()

          summaryContent.innerHTML = data.content;
          loadingIndicator.classList.add('hidden')
          summaryContentTitle.style.display = 'block';

        } catch (error) {
          console.error('ERROR in fetching index.html', error);
          alert('Что-то пошло не так. Попробуйте снова позже')
          loadingIndicator.classList.add('hidden')
          summaryContentTitle.style.display = 'hidden';
        }
        document.getElementById('loading').style.display = 'none';
      } else {
        alert('Пожалуйста, вставьте ссылку на видео')
      }
    });
  </script>
</body>
</html>